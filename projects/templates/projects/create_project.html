{% extends "base.html" %}
{% load project_tags %}

{% block content %}
<h2>Edytuj projekt</h2>

<!-- Wyświetlanie błędów walidacji formularza -->
{% if form.errors %}
    <div class="alert alert-danger">
        <ul>
            {% for field in form %}
                {% for error in field.errors %}
                    <li>{{ error }}</li>
                {% endfor %}
            {% endfor %}
        </ul>
    </div>
{% endif %}

<form method="post">
    {% csrf_token %}
    <div class="mb-3">
        {{ form.title.label_tag }} {{ form.title }}
    </div>
    <div class="mb-3">
        {{ form.code.label_tag }} {{ form.code }}
    </div>
    <div class="mb-3">
        {{ form.description.label_tag }} {{ form.description }}
    </div>

    <h4>Wymagane umiejętności</h4>
    <table class="table">
        <thead>
            <tr>
                <th>Umiejętność</th>
                <th>Liczba specjalistów</th>
                <th>Wybór pracowników</th>
            </tr>
        </thead>
        <tbody>
            {% for skill in skills %}
            <tr>
                <td>{{ skill.name }}</td>
                <td>
                    <input
                        type="number"
                        name="required_count_{{ skill.id }}"
                        id="required_count_{{ skill.id }}"
                        min="0"
                        value="{{ skill_requirements|get_item:skill|default:'0' }}"
                        class="form-control"
                        placeholder="Liczba specjalistów"
                    >
                </td>
                <td>
                    <select name="assign_employee_{{ skill.id }}" multiple class="form-control">
                        {% for employee in suggested_employees %}
                            {% if employee.skill == skill.name %}
                                <option value="{{ employee.employee_id }}">
                                    {{ employee.first_name }} {{ employee.last_name }}
                                </option>
                            {% endif %}
                        {% endfor %}
                        
                        {% if 'suggest_employees' in request.POST and skill_requirements|get_item:skill > 0 and not suggested_employees|has_skill:skill.name %}
                            <option disabled>brak</option>
                        {% endif %}
                    </select>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <button type="submit" name="suggest_employees" class="btn btn-primary">Sugeruj pracowników</button>
    <button type="submit" class="btn btn-success">Zapisz projekt</button>
</form>
{% endblock %}
